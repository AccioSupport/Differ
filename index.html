<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Differ  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Differ  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Differ Docs</a> (64% documented)</p>
        <p class="header-right"><a href="https://github.com/tonyarnold/Differ"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Differ Reference</a>
        <img id="carat" src="img/carat.png" />
        Differ  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/ExtendedPatch.html">ExtendedPatch</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Patch.html">Patch</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/BatchUpdate.html">BatchUpdate</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSCollectionView.html">NSCollectionView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSTableView.html">NSTableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/RangeReplaceableCollection.html">RangeReplaceableCollection</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UICollectionView.html">UICollectionView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UITableView.html">UITableView</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Differ13extendedPatch4from2to4sortSayAA08ExtendedC0Oy7ElementQzGGx_xSbAA0G4DiffVAHO_ANtcSgtSlRzSQAIRQlF">extendedPatch(from:to:sort:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Differ5patch4from2toSayAA5PatchOy7ElementQzGGx_xtSlRzSQAHRQlF">patch(from:to:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Differ5patch4from2to4sortSayAA5PatchOy7ElementQzGGx_xSbAA4DiffVAHO_ANtXEtSlRzSQAIRQlF">patch(from:to:sort:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DiffProtocol.html">DiffProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/BatchUpdate.html">BatchUpdate</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BatchUpdate/MoveStep.html">– MoveStep</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Diff.html">Diff</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Diff/Element.html">– Element</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ExtendedDiff.html">ExtendedDiff</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ExtendedDiff/Element.html">– Element</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NestedDiff.html">NestedDiff</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NestedDiff/Element.html">– Element</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NestedExtendedDiff.html">NestedExtendedDiff</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NestedExtendedDiff/Element.html">– Element</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Point.html">Point</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Trace.html">Trace</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/DiffRowAnimation">DiffRowAnimation</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:6Differ15EqualityCheckera">EqualityChecker</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:6Differ28NestedElementEqualityCheckera">NestedElementEqualityChecker</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='differ' class='heading'>Differ</h1>

<p><a href="https://travis-ci.org/tonyarnold/Differ"><img src="https://travis-ci.org/tonyarnold/Differ.svg?branch=master" alt="Build Status"></a> <a href="https://codecov.io/gh/tonyarnold/Differ"><img src="https://codecov.io/gh/tonyarnold/Differ/branch/master/graph/badge.svg" alt="codecov"></a></p>

<p>Differ generates the differences between <code>Collection</code> instances (this includes Strings!).</p>

<p>It uses a <a href="http://www.xmailserver.org/diff2.pdf">fast algorithm</a> <code>(O((N+M)*D))</code> to do this.</p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>⚡️ <a href="#performance-notes">It is fast</a></li>
<li>Differ supports three types of operations:

<ul>
<li>Insertions</li>
<li>Deletions</li>
<li>Moves (when using <code><a href="Structs/ExtendedDiff.html">ExtendedDiff</a></code>)</li>
</ul></li>
<li>Arbitrary sorting of patches (<code><a href="Enums/Patch.html">Patch</a></code>)</li>
<li>Utilities for updating <code>UITableView</code> and <code>UICollectionView</code> in UIKit, and <code>NSTableView</code> and <code>NSCollectionView</code> in AppKit</li>
<li>Calculating differences between collections containing collections (use <code><a href="Structs/NestedDiff.html">NestedDiff</a></code>)</li>
</ul>
<h2 id='why-do-i-need-it' class='heading'>Why do I need it?</h2>

<p>There&rsquo;s a lot more to calculating diffs than performing table view animations easily!</p>

<p>Wherever you have code that propagates <code>added</code>/<code>removed</code>/<code>moved</code> callbacks from your model to your user interface, you should consider using a library that can calculate differences. Animating small batches of changes is usually going to be faster and provide a more responsive experience than reloading all of your data.</p>

<p>Calculating and acting on differences should also aid you in making a clear separation between data and user interface, and hopefully provide a more declarative approach: your model performs state transition, then your UI code performs appropriate actions based on the calculated differences to that state.</p>
<h2 id='diffs-patches-and-sorting' class='heading'>Diffs, patches and sorting</h2>

<p>Let&rsquo;s consider a simple example of using a patch to transform string <code>&quot;a&quot;</code> into <code>&quot;b&quot;</code>. The following steps describe the patches required to move between these states:</p>

<table><thead>
<tr>
<th style="text-align: left">Change</th>
<th style="text-align: left">Result</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Delete the item at index 0</td>
<td style="text-align: left"><code>&quot;&quot;</code></td>
</tr>
<tr>
<td style="text-align: left">Insert <code>b</code> at index 0</td>
<td style="text-align: left"><code>&quot;b&quot;</code></td>
</tr>
</tbody></table>

<p>If we want to perform these operations in different order, simple reordering of the existing patches won&rsquo;t work:</p>

<table><thead>
<tr>
<th style="text-align: left">Change</th>
<th style="text-align: left">Result</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Insert <code>b</code> at index 0</td>
<td style="text-align: left"><code>&quot;ba&quot;</code></td>
</tr>
<tr>
<td style="text-align: left">Delete the item at index 0</td>
<td style="text-align: left"><code>&quot;a&quot;</code></td>
</tr>
</tbody></table>

<p>&hellip;whoops!</p>

<p>To get to the correct outcome, we need to shift the order of insertions and deletions so that we get this:</p>

<table><thead>
<tr>
<th style="text-align: left">Change</th>
<th style="text-align: left">Result</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Insert <code>b</code> at index 1</td>
<td style="text-align: left"><code>&quot;ab&quot;</code></td>
</tr>
<tr>
<td style="text-align: left">Delete the item at index 0</td>
<td style="text-align: left"><code>&quot;b&quot;</code></td>
</tr>
</tbody></table>
<h3 id='solution' class='heading'>Solution</h3>

<p>In order to mitigate this issue, there are two types of output:</p>

<ul>
<li><em>Diff</em>

<ul>
<li>A sequence of deletions, insertions, and moves (if using <code><a href="Structs/ExtendedDiff.html">ExtendedDiff</a></code>) where deletions point to locations of an item to be deleted in the source and insertions point to the items in the output. Differ produces just one <code><a href="Structs/Diff.html">Diff</a></code>.</li>
</ul></li>
<li><em>Patch</em>

<ul>
<li>An <em>ordered sequence</em> of steps to be applied to the source collection that will result in the second collection. This is based on a <code><a href="Structs/Diff.html">Diff</a></code>, but it can be arbitrarily sorted.</li>
</ul></li>
</ul>
<h3 id='practical-sorting' class='heading'>Practical sorting</h3>

<p>In practice, this means that a diff to transform the string <code>1234</code> into <code>1</code> could be described as the following set of steps:</p>
<pre class="highlight plaintext"><code>DELETE 1
DELETE 2
DELETE 3
</code></pre>

<p>The patch to describe the same change would be:</p>
<pre class="highlight plaintext"><code>DELETE 1
DELETE 1
DELETE 1
</code></pre>

<p>However, if we decided to sort it so that deletions and higher indices are processed first, we get this patch:</p>
<pre class="highlight plaintext"><code>DELETE 3
DELETE 2
DELETE 1
</code></pre>
<h2 id='how-to-use' class='heading'>How to use</h2>
<h3 id='table-and-collection-views' class='heading'>Table and Collection Views</h3>
<pre class="highlight swift"><code><span class="c1">// The following will automatically animate deletions, insertions, and moves:</span>

<span class="n">tableView</span><span class="o">.</span><span class="nf">animateRowChanges</span><span class="p">(</span><span class="nv">oldData</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="nv">newData</span><span class="p">:</span> <span class="k">new</span><span class="p">)</span>

<span class="n">collectionView</span><span class="o">.</span><span class="nf">animateItemChanges</span><span class="p">(</span><span class="nv">oldData</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="nv">newData</span><span class="p">:</span> <span class="k">new</span><span class="p">)</span>

<span class="c1">// It can work with sections, too!</span>

<span class="n">tableView</span><span class="o">.</span><span class="nf">animateRowAndSectionChanges</span><span class="p">(</span><span class="nv">oldData</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="nv">newData</span><span class="p">:</span> <span class="k">new</span><span class="p">)</span>

<span class="n">collectionView</span><span class="o">.</span><span class="nf">animateItemAndSectionChanges</span><span class="p">(</span><span class="nv">oldData</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="nv">newData</span><span class="p">:</span> <span class="k">new</span><span class="p">)</span>

</code></pre>

<p>Please see the <a href="/Examples/">included examples</a> for a working sample.</p>
<h3 id='using-patch-and-diff' class='heading'>Using Patch and Diff</h3>

<p>When you want to determine the steps to transform one collection into another (e.g. you want to animate your user interface according to changes in your model), you could do the following:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">from</span><span class="p">:</span> <span class="kt">T</span>
<span class="k">let</span> <span class="nv">to</span><span class="p">:</span> <span class="kt">T</span>

<span class="c1">// patch() only includes insertions and deletions</span>
<span class="k">let</span> <span class="nv">patch</span><span class="p">:</span> <span class="p">[</span><span class="kt">Patch</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">.</span><span class="kt">Iterator</span><span class="o">.</span><span class="kt">Element</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">patch</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">to</span><span class="p">)</span>

<span class="c1">// extendedPatch() includes insertions, deletions and moves</span>
<span class="k">let</span> <span class="nv">patch</span><span class="p">:</span> <span class="p">[</span><span class="kt">ExtendedPatch</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">.</span><span class="kt">Iterator</span><span class="o">.</span><span class="kt">Element</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">extendedPatch</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">to</span><span class="p">)</span>
</code></pre>

<p>When you need additional control over ordering, you could use the following:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">insertionsFirst</span> <span class="o">=</span> <span class="p">{</span> <span class="n">element1</span><span class="p">,</span> <span class="n">element2</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="k">let</span> <span class="nv">at1</span><span class="p">),</span> <span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="k">let</span> <span class="nv">at2</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">at1</span> <span class="o">&lt;</span> <span class="n">at2</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">insert</span><span class="p">,</span> <span class="o">.</span><span class="n">delete</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span> <span class="o">.</span><span class="n">insert</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="k">let</span> <span class="nv">at1</span><span class="p">),</span> <span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="k">let</span> <span class="nv">at2</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">at1</span> <span class="o">&lt;</span> <span class="n">at2</span>
    <span class="k">default</span><span class="p">:</span> <span class="nf">fatalError</span><span class="p">()</span> <span class="c1">// Unreachable</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Results in a list of patches with insertions preceding deletions</span>
<span class="k">let</span> <span class="nv">patch</span> <span class="o">=</span> <span class="nf">patch</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">to</span><span class="p">,</span> <span class="nv">sort</span><span class="p">:</span> <span class="n">insertionsFirst</span><span class="p">)</span>
</code></pre>

<p>An advanced example: you would like to calculate the difference first, and then generate a patch. In certain cases this can result in a performance improvement.</p>

<p><code>D</code> is the length of a diff:</p>

<ul>
<li>Generating a sorted patch takes <code>O(D^2)</code> time.</li>
<li>The default order takes <code>O(D)</code> to generate.</li>
</ul>
<pre class="highlight swift"><code><span class="c1">// Generate the difference first</span>
<span class="k">let</span> <span class="nv">diff</span> <span class="o">=</span> <span class="n">from</span><span class="o">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>

<span class="c1">// Now generate the list of patches utilising the diff we've just calculated</span>
<span class="k">let</span> <span class="nv">patch</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="nf">patch</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">from</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">to</span><span class="p">)</span>
</code></pre>

<p>If you&rsquo;d like to learn more about how this library works, <code>Graph.playground</code> is a great place to start.</p>
<h2 id='performance-notes' class='heading'>Performance notes</h2>

<p>Differ is <strong>fast</strong>. Many of the other Swift diff libraries use a simple <code>O(n*m)</code> algorithm, which allocates a 2 dimensional array and then walks through every element. This can use <em>a lot</em> of memory.</p>

<p>In the following benchmarks, you should see an order of magnitude difference in calculation time between the two algorithms.</p>

<p>Each measurement is the mean time in seconds it takes to calculate a diff, over 10 runs on an iPhone 6.</p>

<table><thead>
<tr>
<th></th>
<th style="text-align: left">Diff</th>
<th style="text-align: left">Dwifft</th>
</tr>
</thead><tbody>
<tr>
<td>same</td>
<td style="text-align: left">0.0213</td>
<td style="text-align: left">52.3642</td>
</tr>
<tr>
<td>created</td>
<td style="text-align: left">0.0188</td>
<td style="text-align: left">0.0033</td>
</tr>
<tr>
<td>deleted</td>
<td style="text-align: left">0.0184</td>
<td style="text-align: left">0.0050</td>
</tr>
<tr>
<td>diff</td>
<td style="text-align: left">0.1320</td>
<td style="text-align: left">63.4084</td>
</tr>
</tbody></table>

<p>You can run these benchmarks yourself by <a href="https://github.com/tonyarnold/DiffPerformanceSuite">checking out the Diff Performance Suite</a>.</p>

<p>All of the above being said, the algorithm used by Diff works best for collections with <em>small</em> differences between them. However, even for big differences this library is still likely to be faster than those that use the simple <code>O(n*m)</code> algorithm. If you need better performance with large differences between collections, please consider implementing a more suitable approach such as <a href="http://par.cse.nsysu.edu.tw/%7Elcs/Hunt-Szymanski%20Algorithm.php">Hunt &amp; Szymanski&rsquo;s algorithm</a> and/or <a href="https://en.wikipedia.org/wiki/Hirschberg%27s_algorithm">Hirschberg&rsquo;s algorithm</a>.</p>
<h2 id='requirements' class='heading'>Requirements</h2>

<p>Differ requires Swift 4.1 / Xcode 9.3 or later to compile.</p>
<h2 id='installation' class='heading'>Installation</h2>

<p>You can add Differ to your project using Carthage, CocoaPods, Swift Package Manager, or as an Xcode subproject.</p>
<h3 id='carthage' class='heading'>Carthage</h3>
<pre class="highlight ruby"><code><span class="n">github</span> <span class="s2">"tonyarnold/Differ"</span>
</code></pre>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Differ'</span>
</code></pre>
<h2 id='acknowledgements' class='heading'>Acknowledgements</h2>

<p>Differ is a modified fork of <a href="https://github.com/wokalski">Wojtek Czekalski&rsquo;s</a> <a href="https://github.com/wokalski/Diff.swift">Diff.swift</a> - Wojtek deserves all the credit for the original implementation, I am merely its present custodian.</p>

<p>Please, <a href="/tonyarnold/Diff/issues/new">file issues with this fork here in this repository</a>, not in Wojtek&rsquo;s original repository.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://tonyarnold.com" target="_blank" rel="external">Tony Arnold</a>. All rights reserved. (Last updated: 2018-09-06)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
